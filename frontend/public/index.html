<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca de Cursos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050609;
            --panel: #0f1722;
            --panel-alt: #141d2f;
            --accent: #66f6ff;
            --accent-strong: #ff4ef8;
            --text: #f5f7ff;
            --muted: #9aa6c0;
            --danger: #ff6b6b;
            --success: #68ffa5;
            --warning: #ffd369;
        }
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            min-height: 100vh;
            padding: 40px 16px;
            font-family: 'Space Grotesk', 'Segoe UI', sans-serif;
            background: radial-gradient(circle at top, #111b2e 0%, #050609 45%, #030306 100%);
            color: var(--text);
            display: flex;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(90deg, rgba(102, 246, 255, 0.06) 1px, transparent 1px),
                linear-gradient(0deg, rgba(102, 246, 255, 0.06) 1px, transparent 1px);
            background-size: 32px 32px;
            pointer-events: none;
            opacity: 0.4;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, rgba(255, 78, 248, 0.12), transparent 60%);
            pointer-events: none;
        }
        .container {
            width: min(1200px, 100%);
            background: var(--panel);
            border: 4px solid var(--accent);
            border-radius: 18px;
            padding: 48px;
            position: relative;
            box-shadow:
                0 0 25px rgba(102, 246, 255, 0.4),
                0 30px 60px rgba(1, 2, 10, 0.9);
        }
        .container::before {
            content: '';
            position: absolute;
            inset: 12px;
            border: 2px dashed rgba(102, 246, 255, 0.3);
            pointer-events: none;
        }
        h1 {
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            font-size: clamp(1.6rem, 3vw, 2.6rem);
            letter-spacing: 0.08em;
            margin: 0 0 1rem;
            color: var(--accent);
            text-shadow: 0 0 16px rgba(102, 246, 255, 0.9);
        }
        .subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 2rem;
            letter-spacing: 0.2em;
            font-size: 0.85rem;
        }
        h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            color: var(--warning);
            letter-spacing: 0.1em;
            margin-top: 3rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid rgba(255, 211, 105, 0.4);
        }
        h3 {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            margin: 1.5rem 0 1rem;
            color: var(--accent-strong);
        }
        p, label, li, span, input, select, textarea, option, button {
            font-family: 'Space Grotesk', 'Segoe UI', sans-serif;
        }
        .note {
            background: var(--panel-alt);
            border: 2px solid var(--warning);
            padding: 1.25rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            color: var(--warning);
            box-shadow: inset 0 0 20px rgba(255, 211, 105, 0.1);
        }
        .note ul {
            margin: 0.75rem 0 0;
            padding-left: 1.25rem;
        }
        .note li {
            margin-bottom: 0.35rem;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1.5rem;
        }
        button {
            background: var(--panel-alt);
            color: var(--text);
            border: 3px solid var(--accent);
            padding: 14px 18px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
            position: relative;
            box-shadow:
                4px 4px 0 var(--accent),
                12px 12px 30px rgba(0, 0, 0, 0.45);
        }
        button:hover {
            transform: translate(-2px, -2px);
            box-shadow:
                6px 6px 0 var(--accent),
                16px 16px 40px rgba(0, 0, 0, 0.6);
        }
        button:active {
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 var(--accent);
        }
        .test-btn {
            border-color: var(--danger);
            box-shadow: 4px 4px 0 var(--danger);
            color: var(--danger);
        }
        .test-btn:hover {
            box-shadow: 6px 6px 0 var(--danger);
        }
        .panel {
            background: var(--panel-alt);
            padding: 1.5rem;
            border: 2px solid rgba(102, 246, 255, 0.3);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .panel.panel-ghost {
            background: rgba(15, 23, 34, 0.65);
            border-style: dashed;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin: 1.5rem 0;
        }
        .stat-card {
            background: rgba(4, 8, 16, 0.7);
            border: 2px solid rgba(102, 246, 255, 0.4);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.35);
        }
        .stat-card span {
            display: block;
            text-transform: uppercase;
            color: var(--muted);
            font-size: 0.75rem;
            letter-spacing: 0.08em;
        }
        .stat-card strong {
            font-size: 1.6rem;
            color: var(--accent);
            margin-top: 0.5rem;
            display: block;
        }
        .pixel-table {
            width: 100%;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        .pixel-table-header,
        .pixel-table-row {
            display: grid;
            grid-template-columns: 3fr 1fr 1fr;
            gap: 12px;
            padding: 0.85rem 1rem;
        }
        .pixel-table-header {
            background: rgba(255, 255, 255, 0.05);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.7rem;
            color: var(--muted);
        }
        .pixel-table-row {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        .pixel-table-row:nth-child(odd) {
            background: rgba(0, 0, 0, 0.15);
        }
        .pixel-table-row strong {
            color: var(--accent);
        }
        form {
            background: rgba(5, 6, 9, 0.3);
            border: 2px solid rgba(102, 246, 255, 0.25);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: inset 0 0 25px rgba(0, 0, 0, 0.45);
        }
        input, select, textarea {
            width: 100%;
            margin: 10px 0 18px;
            padding: 14px 16px;
            border: 3px solid rgba(154, 166, 192, 0.4);
            border-radius: 8px;
            background: rgba(2, 5, 11, 0.6);
            color: var(--text);
            font-size: 1rem;
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(102, 246, 255, 0.35);
        }
        label {
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--muted);
            font-size: 0.8rem;
            margin-bottom: 0.35rem;
        }
        .log-container {
            background: #03050b;
            border: 2px solid #00ff9c;
            color: #00ff9c;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.75rem;
            padding: 1rem;
            height: 260px;
            overflow-y: auto;
            border-radius: 12px;
            box-shadow: inset 0 0 35px rgba(0, 0, 0, 0.8);
        }
        .log-container p {
            margin: 0.4rem 0;
        }
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        li {
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-left: 6px solid var(--accent);
            margin-bottom: 0.8rem;
        }
        .item-id {
            font-weight: 600;
            color: var(--accent);
        }
        .item-title {
            font-size: 1.1rem;
        }
        .item-details {
            color: var(--muted);
        }
        hr {
            border: none;
            border-top: 1px dashed rgba(255, 255, 255, 0.2);
            margin: 2rem 0;
        }
        @media (max-width: 992px) {
            .container {
                padding: 32px;
            }
        }
        @media (max-width: 640px) {
            body {
                padding: 24px 10px;
            }
            .container {
                padding: 24px;
            }
            h1 {
                font-size: 1.4rem;
            }
            button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="hero">
            <h1>Biblioteca Digital de Cursos</h1>
            <p class="subtitle">Entrega 2 de Web Mobile · Kevin Castro</p>
        </header>

        <section class="panel panel-ghost">
            <div class="note">
                <strong>Requisitos Cumplidos</strong>
                <ul>
                    <li>✅ CRUD completo para Cursos</li>
                    <li>✅ CRUD completo para Instructores</li>
                    <li>✅ CRUD completo para Estudiantes</li>
                    <li>✅ CRUD completo para Inscripciones</li>
                    <li>✅ Transacción MongoDB para inscripciones</li>
                    <li>✅ IDs auto-incrementales</li>
                </ul>
            </div>
        </section>

        <section class="panel">
            <h2>Log de Operaciones</h2>
            <p>Monitorea en tiempo real cada acción ejecutada sobre la API académica.</p>
            <div id="log" class="log-container"></div>
        </section>

        <section class="panel">
            <h2>Reporte Ejecutivo</h2>
            <p>Resumen en tiempo real de inventario académico y ventas consolidadas.</p>
            <div id="reportSummary" class="stats-grid"></div>
            <div class="panel panel-ghost" id="reportSalesPanel">
                <h3>Ventas por Curso</h3>
                <div id="reportSales"></div>
            </div>
        </section>

    <section class="panel">
    <h2>Cursos</h2>
    <p>Administra el catálogo completo de cursos disponibles en la biblioteca digital.</p>
    <div class="btn-group">
        <button onclick="showSection('list')">Listar Cursos</button>
        <button onclick="showSection('insert')">Agregar Curso</button>
        <button onclick="showSection('update')">Actualizar Curso</button>
        <button onclick="showSection('delete')">Eliminar Curso</button>
    </div>

    <div id="listDiv" class="panel panel-ghost" style="display:none;">
        <div id="cursosList"></div>
    </div>

    <div id="insertDiv" class="panel panel-ghost" style="display:none;">
        <h3>Crear Curso</h3>
        <form id="createCursoForm">
            <input type="text" id="titulo" placeholder="T�tulo" required minlength="5"><br>
            <textarea id="descripcion" placeholder="Descripci�n" required minlength="20" maxlength="500"></textarea><br>
            <select id="categoria" required>
                <option value="">Selecciona Categor�a</option>
                <option value="programacion">Programaci�n</option>
                <option value="dise�o">Dise�o</option>
                <option value="marketing">Marketing</option>
                <option value="finanzas">Finanzas</option>
                <option value="otro">Otro</option>
            </select><br>
            <select id="nivel" required>
                <option value="">Selecciona Nivel</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select><br>
            <input type="number" id="horas" placeholder="Horas" required min="1"><br>
            <input type="number" id="precio" placeholder="Precio" required min="0" step="0.01"><br>
            <label for="fechaInicio">Fecha de inicio del curso:</label><br>
            <input type="date" id="fechaInicio" required><br>
            <label for="fechaFin">Fecha de finalización del curso:</label><br>
            <input type="date" id="fechaFin" required><br>
            <select id="estado" required>
                <option value="">Selecciona Estado</option>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
            </select><br>
            <button type="submit">Crear Curso</button>
        </form>
    </div>

    <div id="updateDiv" class="panel panel-ghost" style="display:none;">
        <h3>Actualizar Curso</h3>
        <select id="updateCursoSelect" onchange="loadCursoForUpdate()">
            <option value="">Selecciona un Curso</option>
        </select><br>
        <form id="updateCursoForm">
            <input type="hidden" id="updateId">
            <input type="text" id="updateTitulo" placeholder="Nuevo T�tulo" minlength="5"><br>
            <textarea id="updateDescripcion" placeholder="Nueva Descripci�n" minlength="20" maxlength="500"></textarea><br>
            <select id="updateCategoria">
                <option value="">Selecciona Categor�a</option>
                <option value="programacion">Programaci�n</option>
                <option value="dise�o">Dise�o</option>
                <option value="marketing">Marketing</option>
                <option value="finanzas">Finanzas</option>
                <option value="otro">Otro</option>
            </select><br>
            <select id="updateNivel">
                <option value="">Selecciona Nivel</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select><br>
            <input type="number" id="updateHoras" placeholder="Nuevas Horas" min="1"><br>
            <input type="number" id="updatePrecio" placeholder="Nuevo Precio" min="0" step="0.01"><br>
            <label for="updateFechaInicio">Fecha de inicio del curso:</label><br>
            <input type="date" id="updateFechaInicio"><br>
            <label for="updateFechaFin">Fecha de finalización del curso:</label><br>
            <input type="date" id="updateFechaFin"><br>
            <select id="updateEstado">
                <option value="">Selecciona Estado</option>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
            </select><br>
            <button type="submit">Actualizar Curso</button>
        </form>
    </div>

    <div id="deleteDiv" class="panel panel-ghost" style="display:none;">
        <h3>Eliminar Curso</h3>
        <form id="deleteCursoForm">
            <input type="text" id="deleteId" placeholder="ID del Curso" required><br>
            <button type="submit">Eliminar Curso</button>
        </form>
    </div>
    </section>

    <section class="panel">
    <h2>Instructores</h2>
    <p>Gestiona perfiles profesionales, especialidades y disponibilidad.</p>
    <div class="btn-group">
        <button onclick="showSectionInst('list')">Listar</button>
        <button onclick="showSectionInst('insert')">Insertar</button>
        <button onclick="showSectionInst('update')">Actualizar</button>
        <button onclick="showSectionInst('delete')">Eliminar</button>
    </div>

    <div id="listInstDiv" class="panel panel-ghost" style="display:none;">
        <div id="instructoresList"></div>
    </div>

    <div id="insertInstDiv" class="panel panel-ghost" style="display:block;">
        <h3>Crear Instructor</h3>
        <form id="createInstructorForm">
            <input type="text" id="instNombre" placeholder="Nombre" required><br>
            <input type="email" id="instEmail" placeholder="Email" required><br>
            <input type="text" id="instEspecialidad" placeholder="Especialidad" required><br>
            <button type="submit">Crear Instructor</button>
        </form>
    </div>

    <div id="updateInstDiv" class="panel panel-ghost" style="display:none;">
        <h3>Actualizar Instructor</h3>
        <select id="updateInstSelect" onchange="loadInstForUpdate()">
            <option value="">Selecciona un Instructor</option>
        </select><br>
        <form id="updateInstructorForm">
            <input type="hidden" id="updateInstId">
            <input type="text" id="updateInstNombre" placeholder="Nuevo Nombre" required><br>
            <input type="email" id="updateInstEmail" placeholder="Nuevo Email" required><br>
            <input type="text" id="updateInstEspecialidad" placeholder="Nueva Especialidad" required><br>
            <button type="submit">Actualizar Instructor</button>
        </form>
    </div>

    <div id="deleteInstDiv" class="panel panel-ghost" style="display:none;">
        <h3>Eliminar Instructor</h3>
        <form id="deleteInstructorForm">
            <input type="text" id="deleteInstId" placeholder="ID del Instructor" required><br>
            <button type="submit">Eliminar Instructor</button>
        </form>
    </div>
    </section>

    <section class="panel">
    <h2>Estudiantes</h2>
    <p>Registra y actualiza expedientes académicos de la comunidad estudiantil.</p>
    <div class="btn-group">
        <button onclick="showSectionEst('list')">Listar</button>
        <button onclick="showSectionEst('insert')">Insertar</button>
        <button onclick="showSectionEst('update')">Actualizar</button>
        <button onclick="showSectionEst('delete')">Eliminar</button>
    </div>

    <div id="listEstDiv" class="panel panel-ghost" style="display:none;">
        <div id="estudiantesList"></div>
    </div>

    <div id="insertEstDiv" class="panel panel-ghost" style="display:block;">
        <h3>Crear Estudiante</h3>
        <form id="createEstudianteForm">
            <input type="text" id="estNombre" placeholder="Nombre" required><br>
            <input type="email" id="estEmail" placeholder="Email" required><br>
            <label for="estFechaRegistro">Fecha de registro del estudiante:</label><br>
            <input type="date" id="estFechaRegistro" required>
            <input type="checkbox" id="estFechaRegistroHoy" onchange="setToday('estFechaRegistro')"> Hoy<br>
            <button type="submit">Crear Estudiante</button>
        </form>
    </div>

    <div id="updateEstDiv" class="panel panel-ghost" style="display:none;">
        <h3>Actualizar Estudiante</h3>
        <select id="updateEstSelect" onchange="loadEstForUpdate()">
            <option value="">Selecciona un Estudiante</option>
        </select><br>
        <form id="updateEstudianteForm">
            <input type="hidden" id="updateEstId">
            <input type="text" id="updateEstNombre" placeholder="Nuevo Nombre" required><br>
            <input type="email" id="updateEstEmail" placeholder="Nuevo Email" required><br>
            <label for="updateEstFechaRegistro">Fecha de registro del estudiante:</label><br>
            <input type="date" id="updateEstFechaRegistro" required>
            <input type="checkbox" id="updateEstFechaRegistroHoy" onchange="setToday('updateEstFechaRegistro')"> Hoy<br>
            <button type="submit">Actualizar Estudiante</button>
        </form>
    </div>

    <div id="deleteEstDiv" class="panel panel-ghost" style="display:none;">
        <h3>Eliminar Estudiante</h3>
        <form id="deleteEstudianteForm">
            <input type="text" id="deleteEstId" placeholder="ID del Estudiante" required><br>
            <button type="submit">Eliminar Estudiante</button>
        </form>
    </div>
    </section>

    <section class="panel">
    <h2>Inscripciones</h2>
    <p><strong>Nota:</strong> Motor transaccional MongoDB para garantizar integridad. Usa el botón rojo para simular fallos controlados.</p>
    <div class="btn-group">
        <button onclick="showSectionInsc('list')">Listar</button>
        <button onclick="showSectionInsc('insert')">Insertar</button>
        <button onclick="showSectionInsc('update')">Actualizar</button>
        <button onclick="showSectionInsc('delete')">Eliminar</button>
        <button onclick="testTransaction()" class="test-btn">Probar Transacción (ID Inválido)</button>
    </div>

    <div id="listInscDiv" class="panel panel-ghost" style="display:none;">
        <div id="inscripcionesList"></div>
    </div>

    <div id="insertInscDiv" class="panel panel-ghost" style="display:block;">
        <h3>Crear Inscripci�n</h3>
        <p><strong>Modo Normal:</strong> Usa los selectores desplegables</p>
        <form id="createInscripcionForm">
            <select id="inscCursoId" required>
                <option value="">Selecciona Curso</option>
            </select><br>
            <select id="inscEstudianteId" required>
                <option value="">Selecciona Estudiante</option>
            </select><br>
            <label for="inscFechaRegistro">Fecha de inscripción:</label><br>
            <input type="date" id="inscFechaRegistro" required>
            <input type="checkbox" id="inscFechaRegistroHoy" onchange="setToday('inscFechaRegistro')"> Hoy<br>
            <select id="inscEstado" required>
                <option value="">Selecciona Estado</option>
                <option value="activa">Activa</option>
                <option value="pendiente">Pendiente</option>
                <option value="cancelada">Cancelada</option>
            </select><br>
            <button type="submit">Crear Inscripci�n</button>
        </form>

        <hr>
        <p><strong>Modo Prueba (IDs Manuales):</strong> Ingresa IDs directamente para probar transacciones</p>
        <form id="createInscripcionManualForm">
            <input type="number" id="inscCursoIdManual" placeholder="ID del Curso" required><br>
            <input type="number" id="inscEstudianteIdManual" placeholder="ID del Estudiante" required><br>
            <label for="inscFechaRegistroManual">Fecha de inscripción:</label><br>
            <input type="date" id="inscFechaRegistroManual" required>
            <input type="checkbox" id="inscFechaRegistroManualHoy" onchange="setToday('inscFechaRegistroManual')"> Hoy<br>
            <select id="inscEstadoManual" required>
                <option value="">Selecciona Estado</option>
                <option value="activa">Activa</option>
                <option value="pendiente">Pendiente</option>
                <option value="cancelada">Cancelada</option>
            </select><br>
            <button type="submit">Crear Inscripci�n (Manual)</button>
        </form>
    </div>

    <div id="updateInscDiv" class="panel panel-ghost" style="display:none;">
        <h3>Actualizar Inscripci�n</h3>
        <select id="updateInscSelect" onchange="loadInscForUpdate()">
            <option value="">Selecciona una Inscripci�n</option>
        </select><br>
        <form id="updateInscripcionForm">
            <input type="hidden" id="updateInscId">
            <select id="updateInscCursoId" required>
                <option value="">Selecciona Curso</option>
            </select><br>
            <select id="updateInscEstudianteId" required>
                <option value="">Selecciona Estudiante</option>
            </select><br>
            <label for="updateInscFechaRegistro">Fecha de registro de la inscripción:</label><br>
            <input type="date" id="updateInscFechaRegistro" required>
            <input type="checkbox" id="updateInscFechaRegistroHoy" onchange="setToday('updateInscFechaRegistro')"> Hoy<br>
            <select id="updateInscEstado" required>
                <option value="">Selecciona Estado</option>
                <option value="activa">Activa</option>
                <option value="pendiente">Pendiente</option>
                <option value="cancelada">Cancelada</option>
            </select><br>
            <button type="submit">Actualizar Inscripci�n</button>
        </form>
    </div>

    <div id="deleteInscDiv" class="panel panel-ghost" style="display:none;">
        <h3>Eliminar Inscripci�n</h3>
        <form id="deleteInscripcionForm">
            <input type="text" id="deleteInscId" placeholder="ID de la Inscripci�n" required><br>
            <button type="submit">Eliminar Inscripci�n</button>
        </form>
    </div>

    </section>

    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        const currencyFormatter = new Intl.NumberFormat('es-PE', { style: 'currency', currency: 'USD' });

        async function loadReport() {
            try {
                const res = await fetch(`${API_BASE}/report`);
                if (!res.ok) {
                    throw new Error('No se pudo obtener el reporte');
                }
                const data = await res.json();
                renderReport(data);
                log('Reporte ejecutivo actualizado');
            } catch (error) {
                log('Error al cargar reporte: ' + error.message);
                const summary = document.getElementById('reportSummary');
                if (summary) {
                    summary.innerHTML = '<p>No se pudo cargar el reporte.</p>';
                }
            }
        }

        function renderReport(data) {
            if (!data) return;
            const summary = document.getElementById('reportSummary');
            const sales = document.getElementById('reportSales');
            const { totales, ventas } = data;

            if (summary) {
                summary.innerHTML = `
                    ${createStatCard('Cursos', totales.cursos)}
                    ${createStatCard('Instructores', totales.instructores)}
                    ${createStatCard('Estudiantes', totales.estudiantes)}
                    ${createStatCard('Inscripciones', totales.inscripciones)}
                    ${createStatCard('Ingresos', currencyFormatter.format(ventas.totalIngresos))}
                    ${createStatCard('Ticket Promedio', currencyFormatter.format(ventas.promedioTicket))}
                `;
            }

            if (sales) {
                if (!ventas.detalle.length) {
                    sales.innerHTML = '<p>No hay ventas registradas.</p>';
                    return;
                }

                const rows = ventas.detalle.map(item => `
                    <div class="pixel-table-row">
                        <div>
                            <strong>${item.titulo}</strong>
                            <div class="item-details">${item.categoria}</div>
                        </div>
                        <div>${item.inscripciones}</div>
                        <div>${currencyFormatter.format(item.ingresos)}</div>
                    </div>
                `).join('');

                sales.innerHTML = `
                    <div class="pixel-table">
                        <div class="pixel-table-header">
                            <span>Curso</span>
                            <span>Ventas</span>
                            <span>Ingresos</span>
                        </div>
                        ${rows}
                    </div>
                `;
            }
        }

        function createStatCard(label, value) {
            return `
                <div class="stat-card">
                    <span>${label}</span>
                    <strong>${value}</strong>
                </div>
            `;
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<p>[${timestamp}] ${message}</p>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setToday(inputId) {
            const checkbox = document.getElementById(inputId + 'Hoy');
            const input = document.getElementById(inputId);
            if (checkbox.checked) {
                const today = new Date().toISOString().split('T')[0];
                input.value = today;
            } else {
                input.value = '';
            }
        }

        function showSection(section) {
            // Ocultar todas las secciones
            document.getElementById('listDiv').style.display = 'none';
            document.getElementById('insertDiv').style.display = 'none';
            document.getElementById('updateDiv').style.display = 'none';
            document.getElementById('deleteDiv').style.display = 'none';

            // Mostrar la sección seleccionada
            if (section === 'list') {
                document.getElementById('listDiv').style.display = 'block';
                listCursos();
            } else if (section === 'insert') {
                document.getElementById('insertDiv').style.display = 'block';
            } else if (section === 'update') {
                document.getElementById('updateDiv').style.display = 'block';
                populateUpdateSelect();
            } else if (section === 'delete') {
                document.getElementById('deleteDiv').style.display = 'block';
            }
        }

        function showSectionInst(section) {
            // Ocultar todas las secciones
            document.getElementById('listInstDiv').style.display = 'none';
            document.getElementById('insertInstDiv').style.display = 'none';
            document.getElementById('updateInstDiv').style.display = 'none';
            document.getElementById('deleteInstDiv').style.display = 'none';

            // Mostrar la sección seleccionada
            if (section === 'list') {
                document.getElementById('listInstDiv').style.display = 'block';
                listInstructores();
            } else if (section === 'insert') {
                document.getElementById('insertInstDiv').style.display = 'block';
            } else if (section === 'update') {
                document.getElementById('updateInstDiv').style.display = 'block';
                populateUpdateInstSelect();
            } else if (section === 'delete') {
                document.getElementById('deleteInstDiv').style.display = 'block';
            }
        }

        function showSectionEst(section) {
            // Ocultar todas las secciones
            document.getElementById('listEstDiv').style.display = 'none';
            document.getElementById('insertEstDiv').style.display = 'none';
            document.getElementById('updateEstDiv').style.display = 'none';
            document.getElementById('deleteEstDiv').style.display = 'none';

            // Mostrar la sección seleccionada
            if (section === 'list') {
                document.getElementById('listEstDiv').style.display = 'block';
                listEstudiantes();
            } else if (section === 'insert') {
                document.getElementById('insertEstDiv').style.display = 'block';
            } else if (section === 'update') {
                document.getElementById('updateEstDiv').style.display = 'block';
                populateUpdateEstSelect();
            } else if (section === 'delete') {
                document.getElementById('deleteEstDiv').style.display = 'block';
            }
        }

        function showSectionInsc(section) {
            // Ocultar todas las secciones
            document.getElementById('listInscDiv').style.display = 'none';
            document.getElementById('insertInscDiv').style.display = 'none';
            document.getElementById('updateInscDiv').style.display = 'none';
            document.getElementById('deleteInscDiv').style.display = 'none';

            // Mostrar la sección seleccionada
            if (section === 'list') {
                document.getElementById('listInscDiv').style.display = 'block';
                listInscripciones();
            } else if (section === 'insert') {
                document.getElementById('insertInscDiv').style.display = 'block';
                loadCursosForInsc();
                loadEstudiantesForInsc();
            } else if (section === 'update') {
                document.getElementById('updateInscDiv').style.display = 'block';
                populateUpdateInscSelect();
            } else if (section === 'delete') {
                document.getElementById('deleteInscDiv').style.display = 'block';
            }
        }

        async function populateUpdateSelect() {
            try {
                const res = await fetch(`${API_BASE}/cursos`);
                const data = await res.json();
                const select = document.getElementById('updateCursoSelect');
                select.innerHTML = '<option value="">Selecciona un Curso</option>';
                data.forEach(curso => {
                    const option = document.createElement('option');
                    option.value = curso._id;
                    option.textContent = curso.titulo;
                    select.appendChild(option);
                });
            } catch (error) {
                log('Error al cargar cursos para actualizar: ' + error.message);
            }
        }

        async function populateUpdateInstSelect() {
            try {
                const res = await fetch(`${API_BASE}/instructores`);
                const data = await res.json();
                const select = document.getElementById('updateInstSelect');
                select.innerHTML = '<option value="">Selecciona un Instructor</option>';
                data.forEach(inst => {
                    const option = document.createElement('option');
                    option.value = inst._id;
                    option.textContent = inst.nombre;
                    select.appendChild(option);
                });
            } catch (error) {
                log('Error al cargar instructores para actualizar: ' + error.message);
            }
        }

        async function populateUpdateEstSelect() {
            try {
                const res = await fetch(`${API_BASE}/estudiantes`);
                const data = await res.json();
                const select = document.getElementById('updateEstSelect');
                select.innerHTML = '<option value="">Selecciona un Estudiante</option>';
                data.forEach(est => {
                    const option = document.createElement('option');
                    option.value = est._id;
                    option.textContent = est.nombre;
                    select.appendChild(option);
                });
            } catch (error) {
                log('Error al cargar estudiantes para actualizar: ' + error.message);
            }
        }

        async function populateUpdateInscSelect() {
            try {
                const res = await fetch(`${API_BASE}/inscripciones`);
                const data = await res.json();
                const select = document.getElementById('updateInscSelect');
                select.innerHTML = '<option value="">Selecciona una Inscripci�n</option>';
                data.forEach(insc => {
                    const option = document.createElement('option');
                    option.value = insc._id;
                    option.textContent = `${insc.cursoId?.titulo || 'Curso'} - ${insc.estudianteId?.nombre || 'Estudiante'}`;
                    select.appendChild(option);
                });
            } catch (error) {
                log('Error al cargar inscripciones para actualizar: ' + error.message);
            }
        }

        function loadCursoForUpdate() {
            const id = document.getElementById('updateCursoSelect').value;
            if (!id) return;
            // Fetch the curso data
            fetch(`${API_BASE}/cursos/${id}`)
                .then(res => res.json())
                .then(curso => {
                    document.getElementById('updateId').value = curso._id;
                    document.getElementById('updateTitulo').value = curso.titulo;
                    document.getElementById('updateDescripcion').value = curso.descripcion;
                    document.getElementById('updateCategoria').value = curso.categoria;
                    document.getElementById('updateNivel').value = curso.nivel;
                    document.getElementById('updateHoras').value = curso.horas;
                    document.getElementById('updatePrecio').value = curso.precio;
                    document.getElementById('updateFechaInicio').value = curso.fechaInicio.split('T')[0];
                    document.getElementById('updateFechaFin').value = curso.fechaFin.split('T')[0];
                    document.getElementById('updateEstado').value = curso.estado;
                })
                .catch(error => log('Error al cargar curso: ' + error.message));
        }

        function loadInstForUpdate() {
            const id = document.getElementById('updateInstSelect').value;
            if (!id) return;
            fetch(`${API_BASE}/instructores/${id}`)
                .then(res => res.json())
                .then(inst => {
                    document.getElementById('updateInstId').value = inst._id;
                    document.getElementById('updateInstNombre').value = inst.nombre;
                    document.getElementById('updateInstEmail').value = inst.email;
                    document.getElementById('updateInstEspecialidad').value = inst.especialidad;
                })
                .catch(error => log('Error al cargar instructor: ' + error.message));
        }

        function loadEstForUpdate() {
            const id = document.getElementById('updateEstSelect').value;
            if (!id) return;
            fetch(`${API_BASE}/estudiantes/${id}`)
                .then(res => res.json())
                .then(est => {
                    document.getElementById('updateEstId').value = est._id;
                    document.getElementById('updateEstNombre').value = est.nombre;
                    document.getElementById('updateEstEmail').value = est.email;
                    document.getElementById('updateEstFechaRegistro').value = est.fechaRegistro.split('T')[0];
                })
                .catch(error => log('Error al cargar estudiante: ' + error.message));
        }

        function loadInscForUpdate() {
            const id = document.getElementById('updateInscSelect').value;
            if (!id) return;
            fetch(`${API_BASE}/inscripciones/${id}`)
                .then(res => res.json())
                .then(insc => {
                    document.getElementById('updateInscId').value = insc._id;
                    document.getElementById('updateInscCursoId').value = insc.cursoId;
                    document.getElementById('updateInscEstudianteId').value = insc.estudianteId;
                    document.getElementById('updateInscFechaRegistro').value = insc.fechaRegistro.split('T')[0];
                    document.getElementById('updateInscEstado').value = insc.estado;
                })
                .catch(error => log('Error al cargar inscripci�n: ' + error.message));
        }

        async function listCursos() {
            log('Enviando GET /api/cursos');
            try {
                const res = await fetch(`${API_BASE}/cursos`);
                const data = await res.json();
                let html = '<button onclick="toggleJson()">Mostrar/Ocultar JSON</button><div id="jsonContainer" style="display:none;"><pre>' + JSON.stringify(data, null, 2) + '</pre></div><ul>';
                data.forEach(curso => {
                    html += `<li>
                        <div class="item-id">ID ${curso.id}</div>
                        <div class="item-title">${curso.titulo}</div>
                        <div class="item-details">${curso.categoria} | ${curso.nivel} | ${curso.horas} horas | $${curso.precio}</div>
                        <button onclick="fillUpdate('${curso._id}', '${curso.titulo.replace(/'/g, "\\'")}', '${curso.descripcion.replace(/'/g, "\\'")}', '${curso.categoria}', '${curso.nivel}', ${curso.horas}, ${curso.precio}, '${curso.fechaInicio.split('T')[0]}', '${curso.fechaFin.split('T')[0]}', '${curso.estado}')">Actualizar</button>
                        <button onclick="deleteCurso('${curso._id}')" class="action-btn">Eliminar</button>
                    </li>`;
                });
                html += '</ul>';
                document.getElementById('cursosList').innerHTML = html;
                log('Cursos listados exitosamente');
            } catch (error) {
                document.getElementById('cursosList').innerHTML = '<p>Error: ' + error.message + '</p>';
                log('Error al listar cursos: ' + error.message);
            }
        }

        async function listInstructores() {
            log('Enviando GET /api/instructores');
            try {
                const res = await fetch(`${API_BASE}/instructores`);
                const data = await res.json();
                let html = '<ul>';
                data.forEach(inst => {
                    html += `<li>
                        <div class="item-id">ID ${inst.id}</div>
                        <div class="item-title">${inst.nombre}</div>
                        <div class="item-details">${inst.email} | Especialidad: ${inst.especialidad}</div>
                        <button onclick="deleteInst('${inst._id}')" class="action-btn">Eliminar</button>
                    </li>`;
                });
                html += '</ul>';
                document.getElementById('instructoresList').innerHTML = html;
                log('Instructores listados exitosamente');
            } catch (error) {
                document.getElementById('instructoresList').innerHTML = '<p>Error: ' + error.message + '</p>';
                log('Error al listar instructores: ' + error.message);
            }
        }

        async function listEstudiantes() {
            log('Enviando GET /api/estudiantes');
            try {
                const res = await fetch(`${API_BASE}/estudiantes`);
                const data = await res.json();
                let html = '<ul>';
                data.forEach(est => {
                    html += `<li>
                        <div class="item-id">ID ${est.id}</div>
                        <div class="item-title">${est.nombre}</div>
                        <div class="item-details">${est.email} | Registrado: ${est.fechaRegistro.split('T')[0]}</div>
                        <button onclick="deleteEst('${est._id}')" class="action-btn">Eliminar</button>
                    </li>`;
                });
                html += '</ul>';
                document.getElementById('estudiantesList').innerHTML = html;
                log('Estudiantes listados exitosamente');
            } catch (error) {
                document.getElementById('estudiantesList').innerHTML = '<p>Error: ' + error.message + '</p>';
                log('Error al listar estudiantes: ' + error.message);
            }
        }

        async function listInscripciones() {
            log('Enviando GET /api/inscripciones');
            try {
                const res = await fetch(`${API_BASE}/inscripciones`);
                const data = await res.json();
                let html = '<ul>';
                data.forEach(insc => {
                    html += `<li>
                        <div class="item-title">Curso: ${insc.cursoId?.titulo || `ID ${insc.cursoId}`}</div>
                        <div class="item-details">Estudiante: ${insc.estudianteId?.nombre || `ID ${insc.estudianteId}`} | Estado: ${insc.estado}</div>
                        <button onclick="editInsc('${insc._id}', ${insc.cursoId?.id || insc.cursoId}, ${insc.estudianteId?.id || insc.estudianteId}, '${insc.fechaRegistro?.split('T')[0]}', '${insc.estado}')" class="action-btn">Editar</button>
                        <button onclick="deleteInsc('${insc._id}')" class="action-btn">Eliminar</button>
                    </li>`;
                });
                html += '</ul>';
                document.getElementById('inscripcionesList').innerHTML = html;
                log('Inscripciones listadas exitosamente');
            } catch (error) {
                document.getElementById('inscripcionesList').innerHTML = '<p>Error: ' + error.message + '</p>';
                log('Error al listar inscripciones: ' + error.message);
            }
        }

        function toggleJson() {
            const container = document.getElementById('jsonContainer');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }

        function fillUpdate(id, titulo, descripcion, categoria, nivel, horas, precio, fechaInicio, fechaFin, estado) {
            document.getElementById('updateId').value = id;
            document.getElementById('updateTitulo').value = titulo;
            document.getElementById('updateDescripcion').value = descripcion;
            document.getElementById('updateCategoria').value = categoria;
            document.getElementById('updateNivel').value = nivel;
            document.getElementById('updateHoras').value = horas;
            document.getElementById('updatePrecio').value = precio;
            document.getElementById('updateFechaInicio').value = fechaInicio;
            document.getElementById('updateFechaFin').value = fechaFin;
            document.getElementById('updateEstado').value = estado;
            showSection('update');
            log('Formulario de actualizaci�n llenado para: ' + titulo);
        }

        function fillInscUpdate(id, cursoId, estudianteId, fechaRegistro, estado) {
            document.getElementById('updateInscId').value = id;
            document.getElementById('updateInscCursoId').value = cursoId;
            document.getElementById('updateInscEstudianteId').value = estudianteId;
            document.getElementById('updateInscFechaRegistro').value = fechaRegistro;
            document.getElementById('updateInscEstado').value = estado;
            showSectionInsc('update');
            log('Formulario de actualizaci�n de inscripci�n llenado para: ' + id);
        }

        async function deleteCurso(id) {
            if (confirm('�Est�s seguro de eliminar este curso?')) {
                log(`Enviando DELETE /api/cursos/${id}`);
                try {
                    const res = await fetch(`${API_BASE}/cursos/${id}`, {
                        method: 'DELETE'
                    });
                    const data = await res.json();
                    alert('Curso eliminado: ' + JSON.stringify(data));
                    log(`Curso eliminado exitosamente: ${JSON.stringify(data)}`);
                    listCursos();
                    loadReport();
                } catch (error) {
                    alert('Error: ' + error.message);
                    log(`Error en DELETE /api/cursos/${id}: ${error.message}`);
                }
            }
        }

        async function deleteInst(id) {
            if (confirm('�Est�s seguro de eliminar este instructor?')) {
                log(`Enviando DELETE /api/instructores/${id}`);
                try {
                    const res = await fetch(`${API_BASE}/instructores/${id}`, {
                        method: 'DELETE'
                    });
                    const data = await res.json();
                    alert('Instructor eliminado: ' + JSON.stringify(data));
                    log(`Instructor eliminado exitosamente: ${JSON.stringify(data)}`);
                    listInstructores();
                    loadReport();
                } catch (error) {
                    alert('Error: ' + error.message);
                    log(`Error en DELETE /api/instructores/${id}: ${error.message}`);
                }
            }
        }

        async function deleteEst(id) {
            if (confirm('�Est�s seguro de eliminar este estudiante?')) {
                log(`Enviando DELETE /api/estudiantes/${id}`);
                try {
                    const res = await fetch(`${API_BASE}/estudiantes/${id}`, {
                        method: 'DELETE'
                    });
                    const data = await res.json();
                    alert('Estudiante eliminado: ' + JSON.stringify(data));
                    log(`Estudiante eliminado exitosamente: ${JSON.stringify(data)}`);
                    listEstudiantes();
                    loadReport();
                } catch (error) {
                    alert('Error: ' + error.message);
                    log(`Error en DELETE /api/estudiantes/${id}: ${error.message}`);
                }
            }
        }

        function deleteInsc(id) {
            document.getElementById('deleteInscId').value = id;
            showSectionInsc('delete');
            log('Formulario de eliminación de inscripción llenado con ID: ' + id);
        }

        function editInsc(id, cursoId, estudianteId, fechaRegistro, estado) {
            document.getElementById('updateInscId').value = id;
            document.getElementById('updateInscCursoId').value = cursoId;
            document.getElementById('updateInscEstudianteId').value = estudianteId;
            document.getElementById('updateInscFechaRegistro').value = fechaRegistro;
            document.getElementById('updateInscEstado').value = estado;
            showSectionInsc('update');
            log('Formulario de actualización de inscripción llenado para ID: ' + id);
        }

        async function testTransaction() {
            log('Probando transacción con IDs inválidos...');
            const insc = {
                cursoId: 999, // ID que no existe
                estudianteId: 999, // ID que no existe
                fechaRegistro: new Date().toISOString().split('T')[0],
                estado: "activa"
            };
            try {
                const res = await fetch(`${API_BASE}/inscripciones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(insc)
                });
                const data = await res.json();
                if (res.ok) {
                    alert('Transacción exitosa: ' + JSON.stringify(data));
                    log('Transacción exitosa (inesperado)');
                } else {
                    alert('Transacción fallida (esperado): ' + data.message);
                    log('Transacción fallida como esperado: ' + data.message);
                }
            } catch (error) {
                alert('Error en la prueba: ' + error.message);
                log('Error en la prueba de transacción: ' + error.message);
            }
        }

        document.getElementById('createCursoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const curso = {
                titulo: document.getElementById('titulo').value,
                descripcion: document.getElementById('descripcion').value,
                categoria: document.getElementById('categoria').value,
                nivel: document.getElementById('nivel').value,
                horas: parseInt(document.getElementById('horas').value),
                precio: parseFloat(document.getElementById('precio').value),
                fechaInicio: document.getElementById('fechaInicio').value,
                fechaFin: document.getElementById('fechaFin').value,
                estado: document.getElementById('estado').value
            };
            log(`Enviando POST /api/cursos con datos: ${JSON.stringify(curso)}`);
            try {
                const res = await fetch(`${API_BASE}/cursos`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(curso)
                });
                const data = await res.json();
                alert('Curso creado: ' + JSON.stringify(data));
                log(`Curso creado exitosamente: ${JSON.stringify(data)}`);
                listCursos();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en POST /api/cursos: ${error.message}`);
            }
        });

        document.getElementById('createInstructorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const instructor = {
                nombre: document.getElementById('instNombre').value,
                email: document.getElementById('instEmail').value,
                especialidad: document.getElementById('instEspecialidad').value
            };
            try {
                const res = await fetch(`${API_BASE}/instructores`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(instructor)
                });
                const data = await res.json();
                alert('Instructor creado: ' + JSON.stringify(data));
                log('Instructor creado: ' + instructor.nombre);
                listInstructores();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log('Error al crear instructor: ' + error.message);
            }
        });

        document.getElementById('createInscripcionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const insc = {
                cursoId: parseInt(document.getElementById('inscCursoId').value),
                estudianteId: parseInt(document.getElementById('inscEstudianteId').value),
                fechaRegistro: document.getElementById('inscFechaRegistro').value,
                estado: document.getElementById('inscEstado').value
            };
            log(`Enviando POST /api/inscripciones con datos: ${JSON.stringify(insc)}`);
            try {
                const res = await fetch(`${API_BASE}/inscripciones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(insc)
                });
                const data = await res.json();
                alert('Inscripci�n creada: ' + JSON.stringify(data));
                log(`Inscripci�n creada exitosamente: ${JSON.stringify(data)}`);
                listInscripciones();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log('Error al crear inscripci�n: ' + error.message);
            }
        });

        document.getElementById('createInscripcionManualForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const insc = {
                cursoId: parseInt(document.getElementById('inscCursoIdManual').value),
                estudianteId: parseInt(document.getElementById('inscEstudianteIdManual').value),
                fechaRegistro: document.getElementById('inscFechaRegistroManual').value,
                estado: document.getElementById('inscEstadoManual').value
            };
            log(`Enviando POST /api/inscripciones (MANUAL) con datos: ${JSON.stringify(insc)}`);
            try {
                const res = await fetch(`${API_BASE}/inscripciones`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(insc)
                });
                const data = await res.json();
                alert('Inscripci�n creada (Manual): ' + JSON.stringify(data));
                log(`Inscripci�n creada exitosamente (Manual): ${JSON.stringify(data)}`);
                listInscripciones();
                loadReport();
            } catch (error) {
                alert('Error (Manual): ' + error.message);
                log('Error al crear inscripci�n (Manual): ' + error.message);
            }
        });

        document.getElementById('updateInstructorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateInstId').value;
            const inst = {
                nombre: document.getElementById('updateInstNombre').value,
                email: document.getElementById('updateInstEmail').value,
                especialidad: document.getElementById('updateInstEspecialidad').value
            };
            log(`Enviando PUT /api/instructores/${id} con datos: ${JSON.stringify(inst)}`);
            try {
                const res = await fetch(`${API_BASE}/intructores/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(inst)
                });
                const data = await res.json();
                alert('Instructor actualizado: ' + JSON.stringify(data));
                log(`Instructor actualizado exitosamente: ${JSON.stringify(data)}`);
                listInstructores();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en PUT /api/instructores/${id}: ${error.message}`);
            }
        });

        document.getElementById('updateEstudianteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateEstId').value;
            const est = {
                nombre: document.getElementById('updateEstNombre').value,
                email: document.getElementById('updateEstEmail').value,
                fechaRegistro: document.getElementById('updateEstFechaRegistro').value
            };
            log(`Enviando PUT /api/estudiantes/${id} con datos: ${JSON.stringify(est)}`);
            try {
                const res = await fetch(`${API_BASE}/estudiantes/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(est)
                });
                const data = await res.json();
                alert('Estudiante actualizado: ' + JSON.stringify(data));
                log(`Estudiante actualizado exitosamente: ${JSON.stringify(data)}`);
                listEstudiantes();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en PUT /api/estudiantes/${id}: ${error.message}`);
            }
        });

        document.getElementById('updateInscripcionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateInscId').value;
            const insc = {
                cursoId: parseInt(document.getElementById('updateInscCursoId').value),
                estudianteId: parseInt(document.getElementById('updateInscEstudianteId').value),
                fechaRegistro: document.getElementById('updateInscFechaRegistro').value,
                estado: document.getElementById('updateInscEstado').value
            };
            log(`Enviando PUT /api/inscripciones/${id} con datos: ${JSON.stringify(insc)}`);
            try {
                const res = await fetch(`${API_BASE}/inscripciones/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(insc)
                });
                const data = await res.json();
                alert('Inscripci�n actualizada: ' + JSON.stringify(data));
                log(`Inscripci�n actualizada exitosamente: ${JSON.stringify(data)}`);
                listInscripciones();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en PUT /api/inscripciones/${id}: ${error.message}`);
            }
        });

        document.getElementById('deleteInscripcionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteInscId').value;
            log(`Enviando DELETE /api/inscripciones/${id}`);
            try {
                const res = await fetch(`${API_BASE}/inscripciones/${id}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                alert('Inscripci�n eliminada: ' + JSON.stringify(data));
                log(`Inscripci�n eliminada exitosamente: ${JSON.stringify(data)}`);
                listInscripciones();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en DELETE /api/inscripciones/${id}: ${error.message}`);
            }
        });

        // Event listeners faltantes
        document.getElementById('createEstudianteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const estudiante = {
                nombre: document.getElementById('estNombre').value,
                email: document.getElementById('estEmail').value,
                fechaRegistro: document.getElementById('estFechaRegistro').value
            };
            log(`Enviando POST /api/estudiantes con datos: ${JSON.stringify(estudiante)}`);
            try {
                const res = await fetch(`${API_BASE}/estudiantes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(estudiante)
                });
                const data = await res.json();
                alert('Estudiante creado: ' + JSON.stringify(data));
                log(`Estudiante creado exitosamente: ${JSON.stringify(data)}`);
                listEstudiantes();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en POST /api/estudiantes: ${error.message}`);
            }
        });

        document.getElementById('updateCursoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('updateId').value;
            const curso = {
                titulo: document.getElementById('updateTitulo').value,
                descripcion: document.getElementById('updateDescripcion').value,
                categoria: document.getElementById('updateCategoria').value,
                nivel: document.getElementById('updateNivel').value,
                horas: parseInt(document.getElementById('updateHoras').value),
                precio: parseFloat(document.getElementById('updatePrecio').value),
                fechaInicio: document.getElementById('updateFechaInicio').value,
                fechaFin: document.getElementById('updateFechaFin').value,
                estado: document.getElementById('updateEstado').value
            };
            log(`Enviando PUT /api/cursos/${id} con datos: ${JSON.stringify(curso)}`);
            try {
                const res = await fetch(`${API_BASE}/cursos/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(curso)
                });
                const data = await res.json();
                alert('Curso actualizado: ' + JSON.stringify(data));
                log(`Curso actualizado exitosamente: ${JSON.stringify(data)}`);
                listCursos();
                loadReport();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en PUT /api/cursos/${id}: ${error.message}`);
            }
        });

        document.getElementById('deleteCursoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteId').value;
            log(`Enviando DELETE /api/cursos/${id}`);
            try {
                const res = await fetch(`${API_BASE}/cursos/${id}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                alert('Curso eliminado: ' + JSON.stringify(data));
                log(`Curso eliminado exitosamente: ${JSON.stringify(data)}`);
                listCursos();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en DELETE /api/cursos/${id}: ${error.message}`);
            }
        });

        document.getElementById('deleteInstructorForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteInstId').value;
            log(`Enviando DELETE /api/instructores/${id}`);
            try {
                const res = await fetch(`${API_BASE}/instructores/${id}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                alert('Instructor eliminado: ' + JSON.stringify(data));
                log(`Instructor eliminado exitosamente: ${JSON.stringify(data)}`);
                listInstructores();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en DELETE /api/instructores/${id}: ${error.message}`);
            }
        });

        document.getElementById('deleteEstudianteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('deleteEstId').value;
            log(`Enviando DELETE /api/estudiantes/${id}`);
            try {
                const res = await fetch(`${API_BASE}/estudiantes/${id}`, {
                    method: 'DELETE'
                });
                const data = await res.json();
                alert('Estudiante eliminado: ' + JSON.stringify(data));
                log(`Estudiante eliminado exitosamente: ${JSON.stringify(data)}`);
                listEstudiantes();
            } catch (error) {
                alert('Error: ' + error.message);
                log(`Error en DELETE /api/estudiantes/${id}: ${error.message}`);
            }
        });

        // Cargar cursos para el selector en la secci�n de actualizaci�n
        async function loadCursosForUpdate() {
            try {
                const res = await fetch(`${API_BASE}/cursos`);
                const data = await res.json();
                const select = document.getElementById('updateCursoSelect');
                select.innerHTML = '<option value="">Selecciona un Curso</option>';
                data.forEach(curso => {
                    select.innerHTML += `<option value="${curso._id}">${curso.titulo}</option>`;
                });
                log('Cursos cargados para actualizaci�n');
            } catch (error) {
                log('Error al cargar cursos para actualizaci�n: ' + error.message);
            }
        }

        // Cargar datos del curso seleccionado en el formulario de actualizaci�n
        async function loadCursoForUpdate() {
            const id = document.getElementById('updateCursoSelect').value;
            if (!id) return;
            log(`Cargando datos del curso para actualizaci�n: ${id}`);
            try {
                const res = await fetch(`${API_BASE}/cursos/${id}`);
                const curso = await res.json();
                document.getElementById('updateId').value = curso._id;
                document.getElementById('updateTitulo').value = curso.titulo;
                document.getElementById('updateDescripcion').value = curso.descripcion;
                document.getElementById('updateCategoria').value = curso.categoria;
                document.getElementById('updateNivel').value = curso.nivel;
                document.getElementById('updateHoras').value = curso.horas;
                document.getElementById('updatePrecio').value = curso.precio;
                document.getElementById('updateFechaInicio').value = curso.fechaInicio.split('T')[0];
                document.getElementById('updateFechaFin').value = curso.fechaFin.split('T')[0];
                document.getElementById('updateEstado').value = curso.estado;
                log('Datos del curso cargados en el formulario de actualizaci�n');
            } catch (error) {
                log('Error al cargar datos del curso: ' + error.message);
            }
        }

        // Cargar instructores para el selector en la secci�n de actualizaci�n
        async function loadInstructoresForUpdate() {
            try {
                const res = await fetch(`${API_BASE}/instructores`);
                const data = await res.json();
                const select = document.getElementById('updateInstSelect');
                select.innerHTML = '<option value="">Selecciona un Instructor</option>';
                data.forEach(inst => {
                    select.innerHTML += `<option value="${inst._id}">${inst.nombre}</option>`;
                });
                log('Instructores cargados para actualizaci�n');
            } catch (error) {
                log('Error al cargar instructores para actualizaci�n: ' + error.message);
            }
        }

        // Cargar cursos para el selector de inscripciones
        async function loadCursosForInsc() {
            try {
                console.log('Cargando cursos para inscripciones...');
                const res = await fetch(`${API_BASE}/cursos`);
                const data = await res.json();
                console.log('Cursos obtenidos:', data);
                const select = document.getElementById('inscCursoId');
                select.innerHTML = '<option value="">Selecciona Curso</option>';
                data.forEach(curso => {
                    select.innerHTML += `<option value="${curso.id}">${curso.id} - ${curso.titulo}</option>`;
                });
                console.log('Cursos cargados en select');
            } catch (error) {
                console.error('Error al cargar cursos para inscripciones:', error);
            }
        }

        // Cargar estudiantes para el selector de inscripciones
        async function loadEstudiantesForInsc() {
            try {
                console.log('Cargando estudiantes para inscripciones...');
                const res = await fetch(`${API_BASE}/estudiantes`);
                const data = await res.json();
                console.log('Estudiantes obtenidos:', data);
                const select = document.getElementById('inscEstudianteId');
                select.innerHTML = '<option value="">Selecciona Estudiante</option>';
                data.forEach(est => {
                    select.innerHTML += `<option value="${est.id}">${est.id} - ${est.nombre}</option>`;
                });
                console.log('Estudiantes cargados en select');
            } catch (error) {
                console.error('Error al cargar estudiantes para inscripciones:', error);
            }
        }

        // Cargar cursos para el selector de actualización de inscripciones
        async function loadCursosForUpdateInsc() {
            try {
                const res = await fetch(`${API_BASE}/cursos`);
                const data = await res.json();
                const select = document.getElementById('updateInscCursoId');
                select.innerHTML = '<option value="">Selecciona Curso</option>';
                data.forEach(curso => {
                    select.innerHTML += `<option value="${curso.id}">${curso.id} - ${curso.titulo}</option>`;
                });
                log('Cursos cargados para actualización de inscripciones');
            } catch (error) {
                log('Error al cargar cursos para actualización de inscripciones: ' + error.message);
            }
        }

        // Cargar inscripciones para el selector de actualización
        async function populateUpdateInscSelect() {
            try {
                const res = await fetch(`${API_BASE}/inscripciones`);
                const data = await res.json();
                const select = document.getElementById('updateInscSelect');
                select.innerHTML = '<option value="">Selecciona una Inscripción</option>';
                data.forEach(insc => {
                    const cursoNombre = insc.cursoId?.titulo || `ID ${insc.cursoId}`;
                    const estNombre = insc.estudianteId?.nombre || `ID ${insc.estudianteId}`;
                    select.innerHTML += `<option value="${insc._id}">${cursoNombre} - ${estNombre}</option>`;
                });
                log('Inscripciones cargadas para actualización');
            } catch (error) {
                log('Error al cargar inscripciones para actualización: ' + error.message);
            }
        }

        // Cargar estudiantes para el selector en la sección de actualización
        async function loadEstudiantesForUpdate() {
            try {
                const res = await fetch(`${API_BASE}/estudiantes`);
                const data = await res.json();
                const select = document.getElementById('updateEstSelect');
                select.innerHTML = '<option value="">Selecciona un Estudiante</option>';
                data.forEach(est => {
                    select.innerHTML += `<option value="${est._id}">${est.nombre}</option>`;
                });
                log('Estudiantes cargados para actualización');
            } catch (error) {
                log('Error al cargar estudiantes para actualización: ' + error.message);
            }
        }

        // Cargar estudiantes para el selector de actualización de inscripciones
        async function loadEstudiantesForUpdateInsc() {
            try {
                const res = await fetch(`${API_BASE}/estudiantes`);
                const data = await res.json();
                const select = document.getElementById('updateInscEstudianteId');
                select.innerHTML = '<option value="">Selecciona Estudiante</option>';
                data.forEach(est => {
                    select.innerHTML += `<option value="${est.id}">${est.id} - ${est.nombre}</option>`;
                });
                log('Estudiantes cargados para actualización de inscripciones');
            } catch (error) {
                log('Error al cargar estudiantes para actualización de inscripciones: ' + error.message);
            }
        }

        // Inicializar
        loadCursosForUpdate();
        loadInstructoresForUpdate();
        loadEstudiantesForUpdate();
        loadCursosForInsc();
        loadEstudiantesForInsc();
        loadCursosForUpdateInsc();
        loadEstudiantesForUpdateInsc();
        loadReport();
        showSection('insert');
    </script>
</body>
</html>